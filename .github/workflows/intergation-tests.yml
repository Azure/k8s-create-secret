name: "Trigger Integration tests"
on:
  push:
    branches:
      - master
      - 'releases/*'
  pull_request:
    branches:
      - master
      - 'releases/*'
jobs: 
    trigger-integration-tests:
      name: Trigger Integration tests
      runs-on: ubuntu-latest
      steps:
        - name: Extract branch name
          id: extract_branch
          run: |
            echo "##[set-output name=branchname;]$(echo ${GITHUB_REF##*/})"

        - name: Trigger Test run
          if: github.event.pull_request.base.ref == 'releases/v1' || steps.extract_branch.outputs.branchname == 'releases/v1' || github.event.pull_request.base.ref == 'master' || steps.extract_branch.outputs.branchname == 'master'
          env:
            token: ${{ secrets.L2_REPO_TOKEN }}
            commit: ${{ github.event.pull_request.head.sha }}
            repository: ${{ github.repository }}
            prnumber: ${{ github.event.pull_request.number }}
            prsource: ${{ github.event.pull_request.head.ref }}
            prtarget: ${{ github.event.pull_request.base.ref }}
            username: ${{ secrets.L2_REPO_USER }} 
            prsourcerepository: ${{ github.event.pull_request.head.repo.full_name }}
          run: |
            bash ./IntegrationTests/.github/workflows/TriggerIntegrationTests.sh $token $commit $repository $prnumber $prsource $prtarget $username $prsourcerepository
